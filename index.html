<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Yapƒ±lacaklar</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,300;9..144,500&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --bg:          #0c0d11;
      --surface:     #13151c;
      --surface-2:   #1a1d27;
      --border:      #24273a;
      --border-dim:  #1a1d28;
      --text:        #eae6dc;
      --text-muted:  #676d85;
      --text-dim:    #32374d;
      --gold:        #c8a97e;
      --acil:        #8b1a2f;
      --acil-glow:   rgba(139,26,47,.18);
      --acil-text:   #d45a6a;
      --onemli:      #5542b8;
      --onemli-glow: rgba(85,66,184,.18);
      --onemli-text: #9d90e8;
      --genel:       #1a6e42;
      --genel-glow:  rgba(26,110,66,.18);
      --genel-text:  #3dbf78;
    }

    /* ‚îÄ‚îÄ A√ßƒ±k tema ‚îÄ‚îÄ */
    [data-theme="light"] {
      --bg:          #f5f1eb;
      --surface:     #ffffff;
      --surface-2:   #ede9e2;
      --border:      #ddd8cf;
      --border-dim:  #e8e3db;
      --text:        #1c1917;
      --text-muted:  #78716c;
      --text-dim:    #c0b8b0;
      --gold:        var(--accent, #5b5bd6);
      --acil:        #9b2335;
      --acil-glow:   rgba(155,35,53,.10);
      --acil-text:   #9b2335;
      --onemli:      #5542b8;
      --onemli-glow: rgba(85,66,184,.10);
      --onemli-text: #5542b8;
      --genel:       #1a6e42;
      --genel-glow:  rgba(26,110,66,.10);
      --genel-text:  #1a6e42;
    }

    [data-theme="light"] body {
      background-image:
        radial-gradient(ellipse 80% 50% at 50% -10%, rgba(91,91,214,.05) 0%, transparent 60%),
        radial-gradient(ellipse 60% 40% at 80% 100%, rgba(26,110,66,.03) 0%, transparent 50%);
    }

    /* Ge√ßi≈ü animasyonu */
    *, *::before, *::after {
      box-sizing: border-box; margin: 0; padding: 0;
      transition: background-color .25s, border-color .25s, color .15s;
    }

    /* Ge√ßi≈üten muaf tutulacaklar */
    input, select, button, .spinner::after, #progressBar,
    .cb-box svg, .p-stripe, .badge { transition: none; }

    body {
      min-height: 100vh;
      background: var(--bg);
      background-image:
        radial-gradient(ellipse 80% 50% at 50% -10%, rgba(85,66,184,.06) 0%, transparent 60%),
        radial-gradient(ellipse 60% 40% at 80% 100%, rgba(26,110,66,.04) 0%, transparent 50%);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 0 16px 80px;
      font-family: 'Outfit', sans-serif;
      color: var(--text);
    }

    /* ‚îÄ‚îÄ Tema kontrol widget ‚îÄ‚îÄ */
    .theme-ctrl {
      position: fixed;
      top: 16px; right: 16px;
      display: flex;
      align-items: center;
      gap: 6px;
      z-index: 200;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 40px;
      padding: 5px 8px 5px 6px;
      box-shadow: 0 2px 12px rgba(0,0,0,.15);
      transition: background-color .25s, border-color .25s;
    }

    .theme-toggle {
      width: 28px; height: 28px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background .2s;
      flex-shrink: 0;
      padding: 0;
    }

    .theme-toggle:hover { background: var(--surface-2); }

    /* Renk se√ßici - sadece a√ßƒ±k modda g√∂r√ºn√ºr */
    .color-swatches {
      display: none;
      align-items: center;
      gap: 5px;
      padding-left: 4px;
      border-left: 1px solid var(--border);
    }

    [data-theme="light"] .color-swatches { display: flex; }

    .swatch {
      width: 18px; height: 18px;
      border-radius: 50%;
      border: 2px solid transparent;
      cursor: pointer;
      transition: transform .15s, border-color .15s;
      flex-shrink: 0;
    }

    .swatch:hover  { transform: scale(1.2); }
    .swatch.active { border-color: var(--text); transform: scale(1.15); }

    /* ‚îÄ‚îÄ Progress bar top ‚îÄ‚îÄ */
    #progressBar {
      position: fixed;
      top: 0; left: 0;
      height: 2px;
      width: 0%;
      background: linear-gradient(90deg, var(--acil-text), var(--onemli-text), var(--genel-text));
      transition: width .6s cubic-bezier(.4,0,.2,1);
      z-index: 100;
    }

    /* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
    .card {
      width: 100%;
      max-width: 520px;
      animation: rise .5s cubic-bezier(.16,1,.3,1) both;
    }

    @keyframes rise {
      from { opacity: 0; transform: translateY(24px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       AUTH EKRANI
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    #auth-screen { display: flex; flex-direction: column; }
    #app-screen  { display: none; }
    #confirm-screen { display: none; }

    .auth-brand {
      text-align: center;
      padding: 64px 0 40px;
    }

    .auth-brand h1 {
      font-family: 'Fraunces', serif;
      font-size: 3.2rem;
      font-weight: 300;
      color: var(--text);
      letter-spacing: -1.5px;
      line-height: .95;
    }

    .auth-brand p {
      font-size: 0.82rem;
      color: var(--text-muted);
      margin-top: 10px;
      font-weight: 300;
      letter-spacing: .4px;
    }

    .auth-box {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 36px 32px 32px;
    }

    .tab-row {
      display: flex;
      margin-bottom: 28px;
      border-bottom: 1px solid var(--border);
    }

    .tab-row button {
      flex: 1;
      padding: 10px 0 12px;
      border: none;
      background: transparent;
      font-family: 'Outfit', sans-serif;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      transition: color .2s;
      position: relative;
      letter-spacing: .3px;
    }

    .tab-row button::after {
      content: '';
      position: absolute;
      bottom: -1px; left: 20%; right: 20%;
      height: 1px;
      background: var(--gold);
      transform: scaleX(0);
      transition: transform .3s cubic-bezier(.4,0,.2,1);
    }

    .tab-row button.active { color: var(--text); }
    .tab-row button.active::after { transform: scaleX(1); }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 7px;
      margin-bottom: 18px;
    }

    .form-group label {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text-muted);
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .form-group input {
      padding: 11px 14px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 10px;
      font-family: 'Outfit', sans-serif;
      font-size: 0.9rem;
      color: var(--text);
      outline: none;
      transition: border-color .2s, box-shadow .2s;
    }

    .form-group input::placeholder { color: var(--text-dim); }

    .form-group input:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(200,169,126,.08);
    }

    .remember-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.82rem;
      color: var(--text-muted);
      cursor: pointer;
      user-select: none;
      margin-bottom: 20px;
    }

    .remember-row input[type="checkbox"] {
      width: 14px; height: 14px;
      accent-color: var(--gold);
      cursor: pointer;
    }

    .auth-error {
      font-size: 0.79rem;
      color: var(--acil-text);
      min-height: 16px;
      margin-bottom: 12px;
      text-align: center;
    }

    .auth-btn {
      width: 100%;
      padding: 13px;
      background: var(--text);
      color: var(--bg);
      border: none;
      border-radius: 10px;
      font-family: 'Outfit', sans-serif;
      font-size: 0.88rem;
      font-weight: 600;
      cursor: pointer;
      letter-spacing: .5px;
      transition: opacity .2s, transform .1s;
    }

    .auth-btn:hover  { opacity: .88; }
    .auth-btn:active { transform: scale(.99); }
    .auth-btn:disabled { opacity: .3; cursor: not-allowed; }

    /* ‚îÄ‚îÄ Onay ekranƒ± ‚îÄ‚îÄ */
    #confirm-screen {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 18px;
      text-align: center;
      padding: 64px 32px;
      margin-top: 0;
    }

    .confirm-icon { font-size: 2.4rem; margin-bottom: 18px; }

    .confirm-title {
      font-family: 'Fraunces', serif;
      font-size: 1.5rem;
      font-weight: 300;
      color: var(--text);
      margin-bottom: 10px;
      letter-spacing: -.5px;
    }

    .confirm-sub {
      font-size: 0.84rem;
      color: var(--text-muted);
      line-height: 1.75;
      font-weight: 300;
    }

    .confirm-email { color: var(--gold); font-weight: 500; }

    .back-link {
      display: inline-block;
      margin-top: 24px;
      font-size: 0.8rem;
      color: var(--text-muted);
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: 3px;
      transition: color .2s;
    }

    .back-link:hover { color: var(--text); }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       APP EKRANI
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 52px 0 24px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 24px;
    }

    .app-header h1 {
      font-family: 'Fraunces', serif;
      font-size: 2.6rem;
      font-weight: 300;
      color: var(--text);
      letter-spacing: -1.5px;
      line-height: .95;
    }

    .user-info {
      font-size: 0.73rem;
      color: var(--text-muted);
      margin-top: 8px;
      font-weight: 300;
      letter-spacing: .2px;
    }

    .logout-btn {
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 7px 14px;
      font-family: 'Outfit', sans-serif;
      font-size: 0.76rem;
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      transition: all .2s;
      letter-spacing: .3px;
      margin-top: 4px;
      white-space: nowrap;
    }

    .logout-btn:hover { border-color: var(--acil); color: var(--acil-text); }

    /* ‚îÄ‚îÄ Input satƒ±rƒ± ‚îÄ‚îÄ */
    .input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .input-row input {
      flex: 1;
      padding: 12px 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      font-family: 'Outfit', sans-serif;
      font-size: 0.92rem;
      color: var(--text);
      outline: none;
      transition: border-color .2s, box-shadow .2s;
    }

    .input-row input::placeholder { color: var(--text-dim); }

    .input-row input:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(200,169,126,.06);
    }

    .refresh-btn {
      padding: 12px 14px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-muted);
      font-size: 1rem;
      cursor: pointer;
      transition: all .2s;
      flex-shrink: 0;
      line-height: 1;
    }

    .refresh-btn:hover { color: var(--text); border-color: var(--gold); }
    .refresh-btn.spin  { animation: spin .6s linear; }

    #addBtn {
      padding: 12px 20px;
      background: var(--text);
      color: var(--bg);
      border: none;
      border-radius: 10px;
      font-size: 1.4rem;
      font-weight: 300;
      cursor: pointer;
      transition: opacity .2s, transform .1s;
      flex-shrink: 0;
      line-height: 1;
    }

    #addBtn:hover  { opacity: .88; }
    #addBtn:active { transform: scale(.94); }

    /* ‚îÄ‚îÄ Meta satƒ±rƒ± ‚îÄ‚îÄ */
    .add-meta {
      display: flex;
      gap: 8px;
      margin-bottom: 22px;
    }

    .priority-select, .date-input {
      flex: 1;
      padding: 8px 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-family: 'Outfit', sans-serif;
      font-size: 0.8rem;
      color: var(--text-muted);
      outline: none;
      cursor: pointer;
      transition: border-color .2s;
      appearance: none;
      -webkit-appearance: none;
    }

    .priority-select:focus, .date-input:focus { border-color: var(--gold); }

    .date-input::-webkit-calendar-picker-indicator { filter: invert(.35); cursor: pointer; }

    .priority-select.acil   { border-color: rgba(139,26,47,.6); color: var(--acil-text); }
    .priority-select.onemli { border-color: rgba(85,66,184,.6); color: var(--onemli-text); }
    .priority-select.genel  { border-color: rgba(26,110,66,.6); color: var(--genel-text); }

    /* ‚îÄ‚îÄ Filtreler ‚îÄ‚îÄ */
    .filters {
      display: flex;
      gap: 0;
      margin-bottom: 14px;
      border-bottom: 1px solid var(--border);
    }

    .filters button {
      padding: 8px 18px 10px;
      border: none;
      background: transparent;
      font-family: 'Outfit', sans-serif;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      transition: color .2s;
      position: relative;
      letter-spacing: .3px;
    }

    .filters button::after {
      content: '';
      position: absolute;
      bottom: -1px; left: 0; right: 0;
      height: 1px;
      background: var(--text);
      transform: scaleX(0);
      transition: transform .25s cubic-bezier(.4,0,.2,1);
    }

    .filters button.active { color: var(--text); }
    .filters button.active::after { transform: scaleX(1); }

    /* ‚îÄ‚îÄ Liste ‚îÄ‚îÄ */
    ul {
      list-style: none;
      display: flex;
      flex-direction: column;
    }

    li {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 13px 6px 13px 0;
      border-bottom: 1px solid var(--border-dim);
      animation: slideIn .22s ease both;
      position: relative;
      transition: background .15s;
      border-radius: 0;
    }

    li:last-child { border-bottom: none; }

    li:hover {
      background: rgba(255,255,255,.02);
      border-radius: 8px;
      padding-left: 6px;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-5px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* Custom checkbox */
    .custom-cb {
      position: relative;
      width: 18px; height: 18px;
      flex-shrink: 0;
      margin-top: 1px;
    }

    .custom-cb input[type="checkbox"] {
      position: absolute;
      opacity: 0;
      inset: 0;
      cursor: pointer;
      z-index: 1;
      margin: 0;
    }

    .cb-box {
      width: 18px; height: 18px;
      border: 1.5px solid var(--border);
      border-radius: 5px;
      background: transparent;
      transition: all .18s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .custom-cb input:checked ~ .cb-box {
      background: var(--text);
      border-color: var(--text);
    }

    .cb-box svg {
      width: 10px; height: 10px;
      stroke: var(--bg);
      stroke-width: 2.5;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
      opacity: 0;
      transform: scale(.5);
      transition: all .18s cubic-bezier(.4,0,.2,1);
    }

    .custom-cb input:checked ~ .cb-box svg {
      opacity: 1;
      transform: scale(1);
    }

    /* Priority stripe */
    .p-stripe {
      width: 2.5px;
      align-self: stretch;
      border-radius: 2px;
      flex-shrink: 0;
      min-height: 20px;
      opacity: .85;
    }

    .p-stripe.acil   { background: var(--acil); }
    .p-stripe.onemli { background: var(--onemli); }
    .p-stripe.genel  { background: var(--genel); }

    .task-body {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 3px;
      min-width: 0;
    }

    .task-label {
      font-size: 0.9rem;
      color: var(--text);
      word-break: break-word;
      line-height: 1.45;
      font-weight: 400;
      transition: color .2s;
    }

    li.done .task-label {
      text-decoration: line-through;
      text-decoration-color: var(--border);
      color: var(--text-dim);
    }

    .deadline-text {
      font-size: 0.71rem;
      color: var(--text-muted);
      letter-spacing: .15px;
    }

    .deadline-text.overdue { color: var(--acil-text); }
    .deadline-text.today   { color: #d4a42a; }

    .badge {
      font-size: 0.64rem;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 20px;
      flex-shrink: 0;
      margin-top: 2px;
      letter-spacing: .7px;
      text-transform: uppercase;
    }

    .badge.acil   { background: var(--acil-glow);   color: var(--acil-text);   border: 1px solid rgba(139,26,47,.25); }
    .badge.onemli { background: var(--onemli-glow); color: var(--onemli-text); border: 1px solid rgba(85,66,184,.25); }
    .badge.genel  { background: var(--genel-glow);  color: var(--genel-text);  border: 1px solid rgba(26,110,66,.25); }

    .task-actions {
      display: flex;
      gap: 2px;
      opacity: 0;
      transition: opacity .15s;
      margin-top: 1px;
    }

    li:hover .task-actions { opacity: 1; }

    .icon-btn {
      background: none;
      border: none;
      font-size: 0.85rem;
      cursor: pointer;
      color: var(--text-dim);
      transition: color .15s, background .15s;
      padding: 4px 6px;
      border-radius: 5px;
      line-height: 1;
    }

    .edit-btn:hover { color: var(--gold); background: rgba(200,169,126,.08); }
    .del-btn:hover  { color: var(--acil-text); background: var(--acil-glow); }

    /* Editing */
    li.editing {
      background: var(--surface);
      border-radius: 10px;
      padding: 14px;
      border: 1px solid var(--border);
      margin: 4px 0;
    }

    li.editing .task-actions { opacity: 1; }

    .edit-input {
      width: 100%;
      padding: 7px 10px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 7px;
      font-family: 'Outfit', sans-serif;
      font-size: 0.9rem;
      color: var(--text);
      outline: none;
      transition: border-color .2s;
    }

    .edit-input:focus { border-color: var(--gold); }

    .edit-meta {
      display: flex;
      gap: 6px;
      margin-top: 7px;
    }

    .edit-priority, .edit-date {
      flex: 1;
      padding: 6px 9px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 7px;
      font-family: 'Outfit', sans-serif;
      font-size: 0.79rem;
      color: var(--text-muted);
      outline: none;
    }

    .save-btn {
      background: var(--text);
      color: var(--bg);
      border: none;
      border-radius: 7px;
      padding: 6px 14px;
      font-family: 'Outfit', sans-serif;
      font-size: 0.77rem;
      font-weight: 600;
      cursor: pointer;
      letter-spacing: .4px;
      transition: opacity .2s;
      flex-shrink: 0;
      white-space: nowrap;
    }

    .save-btn:hover { opacity: .85; }

    .empty {
      text-align: center;
      color: var(--text-dim);
      font-size: 0.84rem;
      padding: 48px 0;
      font-weight: 300;
      letter-spacing: .3px;
    }

    /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
    .footer {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.76rem;
      color: var(--text-muted);
      padding-top: 14px;
      border-top: 1px solid var(--border-dim);
    }

    .clear-btn {
      background: none;
      border: none;
      font-family: 'Outfit', sans-serif;
      font-size: 0.76rem;
      color: var(--text-muted);
      cursor: pointer;
      transition: color .2s;
    }

    .clear-btn:hover { color: var(--acil-text); }

    /* ‚îÄ‚îÄ Spinner ‚îÄ‚îÄ */
    .spinner { display: flex; justify-content: center; padding: 36px 0; }

    .spinner::after {
      content: '';
      width: 20px; height: 20px;
      border: 1.5px solid var(--border);
      border-top-color: var(--gold);
      border-radius: 50%;
      animation: spin .75s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
    .toast {
      position: fixed;
      bottom: 28px; left: 50%;
      transform: translateX(-50%) translateY(10px);
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 0.82rem;
      opacity: 0;
      transition: opacity .25s, transform .25s;
      pointer-events: none;
      z-index: 999;
      white-space: nowrap;
      letter-spacing: .2px;
    }

    .toast.show  { opacity: 1; transform: translateX(-50%) translateY(0); }
    .toast.error { border-color: rgba(139,26,47,.4); color: var(--acil-text); }
  </style>
</head>
<body>

<div id="progressBar"></div>

<!-- Tema kontrol√º -->
<div class="theme-ctrl">
  <button class="theme-toggle" id="themeToggle" title="Tema deƒüi≈ütir">üåô</button>
  <div class="color-swatches" id="colorSwatches">
    <div class="swatch active" data-color="#5b5bd6" style="background:#5b5bd6" title="ƒ∞ndigo"></div>
    <div class="swatch" data-color="#7c3aed" style="background:#7c3aed" title="Mor"></div>
    <div class="swatch" data-color="#e11d48" style="background:#e11d48" title="Kƒ±rmƒ±zƒ±"></div>
    <div class="swatch" data-color="#d97706" style="background:#d97706" title="Amber"></div>
    <div class="swatch" data-color="#0d9488" style="background:#0d9488" title="Teal"></div>
    <div class="swatch" data-color="#059669" style="background:#059669" title="Ye≈üil"></div>
  </div>
</div>

<div class="card">

  <!-- AUTH EKRANI -->
  <div id="auth-screen">
    <div class="auth-brand">
      <h1>Yapƒ±lacaklar</h1>
      <p>G√∂revlerini y√∂net, √∂nceliklendir, tamamla.</p>
    </div>

    <div class="auth-box">
      <div class="tab-row">
        <button id="tab-login" class="active" onclick="switchTab('login')">Giri≈ü Yap</button>
        <button id="tab-register" onclick="switchTab('register')">Kayƒ±t Ol</button>
      </div>

      <div class="form-group">
        <label for="auth-email">E-posta</label>
        <input id="auth-email" type="email" placeholder="ornek@mail.com" autocomplete="email" />
      </div>

      <div class="form-group">
        <label for="auth-pass">≈ûifre</label>
        <input id="auth-pass" type="password" placeholder="En az 6 karakter" autocomplete="current-password" />
      </div>

      <label class="remember-row" id="remember-row">
        <input type="checkbox" id="rememberMe" checked />
        Beni hatƒ±rla
      </label>

      <p class="auth-error" id="auth-error"></p>

      <button class="auth-btn" id="auth-submit">Giri≈ü Yap</button>
    </div>
  </div>

  <!-- ONAY BEKLENƒ∞YOR -->
  <div id="confirm-screen">
    <div class="confirm-icon">üì¨</div>
    <div class="confirm-title">E-postanƒ± onayla</div>
    <p class="confirm-sub">
      <span class="confirm-email" id="confirm-email-text"></span> adresine<br/>
      bir onay baƒülantƒ±sƒ± g√∂nderdik.<br/>
      L√ºtfen gelen kutunu kontrol et.
    </p>
    <span class="back-link" onclick="showScreen('auth')">‚Üê Giri≈ü ekranƒ±na d√∂n</span>
  </div>

  <!-- UYGULAMA -->
  <div id="app-screen">
    <div class="app-header">
      <div>
        <h1>Yapƒ±lacaklar</h1>
        <div class="user-info" id="user-email"></div>
      </div>
      <button class="logout-btn" id="logoutBtn">√áƒ±kƒ±≈ü</button>
    </div>

    <div class="input-row">
      <input id="newTask" type="text" placeholder="Yeni g√∂rev ekle..." maxlength="120" />
      <button id="refreshBtn" class="refresh-btn" title="Yenile">&#x21BB;</button>
      <button id="addBtn">+</button>
    </div>

    <div class="add-meta">
      <select id="newPriority" class="priority-select genel">
        <option value="genel">‚óè Genel</option>
        <option value="onemli">‚óè √ñnemli</option>
        <option value="acil">‚óè Acil</option>
      </select>
      <input id="newDeadline" type="date" class="date-input" />
    </div>

    <div class="filters">
      <button class="active" data-filter="all">T√ºm√º</button>
      <button data-filter="active">Bekleyen</button>
      <button data-filter="done">Tamamlanan</button>
    </div>

    <ul id="list"></ul>

    <div class="footer">
      <span id="counter"></span>
      <button class="clear-btn" id="clearDone">Tamamlananlarƒ± sil</button>
    </div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TEMA Y√ñNETƒ∞Mƒ∞
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  const SWATCHES      = document.querySelectorAll('.swatch');
  const themeToggle   = document.getElementById('themeToggle');
  const html          = document.documentElement;

  const ACCENT_COLORS = {
    '#5b5bd6': 'rgba(91,91,214,',
    '#7c3aed': 'rgba(124,58,237,',
    '#e11d48': 'rgba(225,29,72,',
    '#d97706': 'rgba(217,119,6,',
    '#0d9488': 'rgba(13,148,136,',
    '#059669': 'rgba(5,150,105,',
  };

  function applyAccent(color) {
    html.style.setProperty('--accent', color);
    // --gold da g√ºncellensin (light modda --gold = var(--accent))
    SWATCHES.forEach(s => s.classList.toggle('active', s.dataset.color === color));
    localStorage.setItem('accentColor', color);
  }

  function applyTheme(theme) {
    html.setAttribute('data-theme', theme);
    themeToggle.textContent = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    localStorage.setItem('theme', theme);
  }

  themeToggle.addEventListener('click', () => {
    const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    applyTheme(next);
  });

  SWATCHES.forEach(s => {
    s.addEventListener('click', () => applyAccent(s.dataset.color));
  });

  // Kaydedilmi≈ü tercihleri y√ºkle
  const savedTheme  = localStorage.getItem('theme') || 'dark';
  const savedAccent = localStorage.getItem('accentColor') || '#5b5bd6';
  applyTheme(savedTheme);
  applyAccent(savedAccent);

  const SUPABASE_URL  = 'https://sdaslqmjfgtnylpyegao.supabase.co';
  const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNkYXNscW1qZmd0bnlscHllZ2FvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MTk4NDIsImV4cCI6MjA4NzE5NTg0Mn0.FIkLhE1vp8BU2v7tWnofDK71bKtIOvJMo_MGimKxc_E';

  const db = supabase.createClient(SUPABASE_URL, SUPABASE_ANON, {
    auth: { detectSessionInUrl: true }
  });

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     EKRAN Y√ñNETƒ∞Mƒ∞
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  function showScreen(name) {
    document.getElementById('auth-screen').style.display    = name === 'auth'    ? 'flex'  : 'none';
    document.getElementById('confirm-screen').style.display = name === 'confirm' ? 'block' : 'none';
    document.getElementById('app-screen').style.display     = name === 'app'     ? 'block' : 'none';
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     AUTH: SEKME
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  let currentTab = 'login';

  function switchTab(tab) {
    currentTab = tab;
    document.getElementById('tab-login').classList.toggle('active', tab === 'login');
    document.getElementById('tab-register').classList.toggle('active', tab === 'register');
    document.getElementById('auth-submit').textContent = tab === 'login' ? 'Giri≈ü Yap' : 'Kayƒ±t Ol';
    document.getElementById('auth-error').textContent  = '';
    document.getElementById('auth-pass').autocomplete  = tab === 'login' ? 'current-password' : 'new-password';
    document.getElementById('remember-row').style.display = tab === 'login' ? 'flex' : 'none';
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     AUTH: Gƒ∞Rƒ∞≈û / KAYIT
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  document.getElementById('auth-submit').addEventListener('click', async () => {
    const email = document.getElementById('auth-email').value.trim();
    const pass  = document.getElementById('auth-pass').value;
    const errEl = document.getElementById('auth-error');
    const btn   = document.getElementById('auth-submit');

    errEl.textContent = '';
    if (!email || !pass) { errEl.textContent = 'E-posta ve ≈üifre gerekli.'; return; }

    btn.disabled = true;
    btn.textContent = '¬∑¬∑¬∑';

    if (currentTab === 'login') {
      const remember = document.getElementById('rememberMe').checked;
      localStorage.setItem('rememberMe', remember ? '1' : '0');

      const { error } = await db.auth.signInWithPassword({ email, password: pass });
      if (error) {
        errEl.textContent = error.message === 'Invalid login credentials'
          ? 'E-posta veya ≈üifre hatalƒ±.'
          : error.message === 'Email not confirmed'
          ? 'E-postanƒ± hen√ºz onaylamamƒ±≈üsƒ±n.'
          : error.message;
      } else {
        if (!remember) window.addEventListener('beforeunload', () => db.auth.signOut());
      }
    } else {
      const { error } = await db.auth.signUp({
        email,
        password: pass,
        options: { emailRedirectTo: 'https://todo-app-3on.pages.dev' }
      });
      if (error) {
        const signupMsgs = {
          'User already registered': 'Bu e-posta zaten kayƒ±tlƒ±.',
          'Password should be at least 6 characters': '≈ûifre en az 6 karakter olmalƒ±.',
        };
        errEl.textContent = signupMsgs[error.message] || 'Kayƒ±t sƒ±rasƒ±nda bir hata olu≈ütu.';
      } else {
        document.getElementById('confirm-email-text').textContent = email;
        showScreen('confirm');
      }
    }

    btn.disabled = false;
    switchTab(currentTab);
  });

  ['auth-email','auth-pass'].forEach(id => {
    document.getElementById(id).addEventListener('keydown', e => {
      if (e.key === 'Enter') document.getElementById('auth-submit').click();
    });
  });

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     AUTH STATE
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  let currentUser = null;

  db.auth.onAuthStateChange(async (event, session) => {
    if (session) {
      if (event === 'INITIAL_SESSION' && localStorage.getItem('rememberMe') === '0') {
        await db.auth.signOut();
        return;
      }
      currentUser = session.user;
      document.getElementById('user-email').textContent = session.user.email;
      if (event === 'SIGNED_IN' || event === 'INITIAL_SESSION') {
        showScreen('app');
        await loadTasks();
      }
    } else {
      currentUser = null;
      tasks = [];
      showScreen('auth');
    }
  });

  document.getElementById('logoutBtn').addEventListener('click', async () => {
    await db.auth.signOut();
  });

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TODO UYGULAMASI
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  let tasks  = [];
  let filter = 'all';

  const taskInput   = document.getElementById('newTask');
  const prioritySel = document.getElementById('newPriority');
  const deadlineInp = document.getElementById('newDeadline');
  const list        = document.getElementById('list');
  const counter     = document.getElementById('counter');
  const filterBtns  = document.querySelectorAll('.filters button');

  prioritySel.addEventListener('change', () => {
    prioritySel.className = 'priority-select ' + prioritySel.value;
  });

  deadlineInp.min = new Date().toISOString().split('T')[0];

  function showToast(msg, type = '') {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast show' + (type ? ' ' + type : '');
    setTimeout(() => t.classList.remove('show'), 3000);
  }

  function escHtml(s) {
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  const PRIORITY_LABEL = { acil: 'Acil', onemli: '√ñnemli', genel: 'Genel' };

  function formatDeadline(dateStr) {
    if (!dateStr) return null;
    const today    = new Date(); today.setHours(0,0,0,0);
    const deadline = new Date(dateStr + 'T00:00:00');
    const diff     = Math.round((deadline - today) / 86400000);
    const label    = deadline.toLocaleDateString('tr-TR', { day:'numeric', month:'short', year:'numeric' });
    if (diff < 0)   return { text: `Ge√ßti ‚Äî ${label}`, cls: 'overdue' };
    if (diff === 0) return { text: 'Bug√ºn son g√ºn',    cls: 'today'   };
    if (diff === 1) return { text: 'Yarƒ±n son g√ºn',    cls: ''        };
    return { text: `Son: ${label}`, cls: '' };
  }

  function updateProgress() {
    const total = tasks.length;
    const done  = tasks.filter(t => t.done).length;
    const pct   = total === 0 ? 0 : Math.round((done / total) * 100);
    document.getElementById('progressBar').style.width = pct + '%';
  }

  function render() {
    const visible = tasks.filter(t =>
      filter === 'all'    ? true :
      filter === 'active' ? !t.done : t.done
    );

    list.innerHTML = '';

    if (visible.length === 0) {
      list.innerHTML = '<p class="empty">Hen√ºz g√∂rev yok.</p>';
    } else {
      visible.forEach(t => {
        const p  = t.priority || 'genel';
        const dl = formatDeadline(t.deadline);
        const li = document.createElement('li');
        if (t.done) li.classList.add('done');

        li.innerHTML = `
          <div class="custom-cb">
            <input type="checkbox" ${t.done ? 'checked' : ''} data-id="${t.id}" />
            <div class="cb-box">
              <svg viewBox="0 0 12 12"><polyline points="1.5,6 5,9.5 10.5,2.5"/></svg>
            </div>
          </div>
          <div class="p-stripe ${p}"></div>
          <div class="task-body">
            <span class="task-label">${escHtml(t.text)}</span>
            ${dl ? `<span class="deadline-text ${dl.cls}">${dl.text}</span>` : ''}
          </div>
          <span class="badge ${p}">${PRIORITY_LABEL[p]}</span>
          <div class="task-actions">
            <button class="icon-btn edit-btn" data-id="${t.id}" title="D√ºzenle">&#x270E;</button>
            <button class="icon-btn del-btn"  data-id="${t.id}" title="Sil">&#x2715;</button>
          </div>
        `;
        list.appendChild(li);
      });
    }

    const pending = tasks.filter(t => !t.done).length;
    counter.textContent = `${pending} g√∂rev bekliyor`;
    updateProgress();
  }

  async function loadTasks() {
    list.innerHTML = '<div class="spinner"></div>';
    const { data, error } = await db
      .from('todos')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) { showToast('Veriler y√ºklenemedi.', 'error'); return; }
    tasks = data;
    render();
  }

  const VALID_PRIORITIES = ['genel', 'onemli', 'acil'];

  async function addTask() {
    const text = taskInput.value.trim();
    if (!text || text.length > 120 || !currentUser) return;
    const priority = VALID_PRIORITIES.includes(prioritySel.value) ? prioritySel.value : 'genel';
    const deadlineRaw = deadlineInp.value;
    const deadline = /^\d{4}-\d{2}-\d{2}$/.test(deadlineRaw) ? deadlineRaw : null;
    taskInput.value   = '';
    deadlineInp.value = '';
    prioritySel.value = 'genel';
    prioritySel.className = 'priority-select genel';

    const { data, error } = await db
      .from('todos')
      .insert({ text, done: false, priority, deadline, user_id: currentUser.id })
      .select()
      .single();

    if (error) { showToast('G√∂rev eklenemedi.', 'error'); return; }
    tasks.unshift(data);
    render();
  }

  document.getElementById('addBtn').addEventListener('click', addTask);
  taskInput.addEventListener('keydown', e => { if (e.key === 'Enter') addTask(); });

  document.getElementById('refreshBtn').addEventListener('click', async () => {
    const btn = document.getElementById('refreshBtn');
    btn.classList.add('spin');
    await loadTasks();
    setTimeout(() => btn.classList.remove('spin'), 600);
  });

  list.addEventListener('change', async e => {
    if (e.target.type !== 'checkbox') return;
    const id   = +e.target.dataset.id;
    const done = e.target.checked;
    const { error } = await db.from('todos').update({ done }).eq('id', id);
    if (error) { showToast('G√ºncellenemedi.', 'error'); return; }
    const t = tasks.find(t => t.id === id);
    if (t) t.done = done;
    render();
  });

  list.addEventListener('click', async e => {
    if (e.target.classList.contains('del-btn')) {
      const id = +e.target.dataset.id;
      const { error } = await db.from('todos').delete().eq('id', id);
      if (error) { showToast('Silinemedi.', 'error'); return; }
      tasks = tasks.filter(t => t.id !== id);
      render();
      return;
    }

    if (e.target.classList.contains('edit-btn')) {
      const id = +e.target.dataset.id;
      const t  = tasks.find(t => t.id === id);
      if (!t) return;
      const p  = t.priority || 'genel';
      const li = e.target.closest('li');
      li.classList.add('editing');
      li.innerHTML = `
        <div class="custom-cb">
          <input type="checkbox" ${t.done ? 'checked' : ''} data-id="${t.id}" />
          <div class="cb-box">
            <svg viewBox="0 0 12 12"><polyline points="1.5,6 5,9.5 10.5,2.5"/></svg>
          </div>
        </div>
        <div class="p-stripe ${p}"></div>
        <div class="task-body">
          <input class="edit-input" type="text" value="${escHtml(t.text)}" maxlength="120" data-id="${t.id}" />
          <div class="edit-meta">
            <select class="edit-priority" data-id="${t.id}">
              <option value="genel"  ${t.priority==='genel'  ?'selected':''}>‚óè Genel</option>
              <option value="onemli" ${t.priority==='onemli' ?'selected':''}>‚óè √ñnemli</option>
              <option value="acil"   ${t.priority==='acil'   ?'selected':''}>‚óè Acil</option>
            </select>
            <input class="edit-date" type="date" value="${t.deadline||''}" data-id="${t.id}" />
          </div>
        </div>
        <div class="task-actions" style="opacity:1">
          <button class="save-btn" data-id="${t.id}">Kaydet</button>
          <button class="icon-btn del-btn" data-id="${t.id}" title="Sil">&#x2715;</button>
        </div>
      `;
      const ei = li.querySelector('.edit-input');
      ei.focus();
      ei.selectionStart = ei.selectionEnd = ei.value.length;
      ei.addEventListener('keydown', ev => {
        if (ev.key === 'Enter')  commitEdit(id, li);
        if (ev.key === 'Escape') render();
      });
      return;
    }

    if (e.target.classList.contains('save-btn')) {
      const li = e.target.closest('li');
      const id = +e.target.dataset.id;
      commitEdit(id, li);
    }
  });

  async function commitEdit(id, li) {
    const text     = li.querySelector('.edit-input').value.trim();
    const priority = VALID_PRIORITIES.includes(li.querySelector('.edit-priority').value)
      ? li.querySelector('.edit-priority').value : 'genel';
    const deadlineRaw = li.querySelector('.edit-date').value;
    const deadline = /^\d{4}-\d{2}-\d{2}$/.test(deadlineRaw) ? deadlineRaw : null;
    if (!text || text.length > 120) return;
    const { error } = await db.from('todos').update({ text, priority, deadline }).eq('id', id);
    if (error) { showToast('D√ºzenlenemedi.', 'error'); return; }
    const t = tasks.find(t => t.id === id);
    if (t) { t.text = text; t.priority = priority; t.deadline = deadline; }
    render();
  }

  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      filter = btn.dataset.filter;
      filterBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      render();
    });
  });

  document.getElementById('clearDone').addEventListener('click', async () => {
    const ids = tasks.filter(t => t.done).map(t => t.id);
    if (!ids.length) return;
    const { error } = await db.from('todos').delete().in('id', ids);
    if (error) { showToast('Silinemedi.', 'error'); return; }
    tasks = tasks.filter(t => !t.done);
    render();
  });
</script>
</body>
</html>
